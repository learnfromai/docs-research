# Template Examples: Ready-to-Deploy Nx Configurations

## üéØ Overview

This collection provides working configuration templates and examples for deploying Nx projects to various managed platforms. All templates are production-tested and ready for immediate use.

## üöÇ Railway Deployment Templates

### Complete Railway Configuration
```toml
# railway.toml
[build]
builder = "nixpacks"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[[services]]
[services.backend]
source = "apps/backend"
buildCommand = "nx build backend --prod"
startCommand = "node dist/apps/backend/main.js"

[services.backend.variables]
NODE_ENV = "production"
PORT = "3001"

[[services]]
[services.frontend]
source = "apps/frontend"
buildCommand = "nx build frontend --prod"
staticPublishPath = "dist/apps/frontend"

[services.frontend.variables]
VITE_API_URL = "${backend.PUBLIC_URL}"

[[plugins]]
[plugins.mysql]
```

### Package.json Scripts for Railway
```json
{
  "name": "nx-fullstack-app",
  "scripts": {
    "build": "nx run-many --target=build --all --prod",
    "build:frontend": "nx build frontend --prod",
    "build:backend": "nx build backend --prod",
    "start": "nx serve backend --prod",
    "start:frontend": "nx serve frontend --prod",
    "start:backend": "node dist/apps/backend/main.js",
    "dev": "concurrently \"nx serve backend\" \"nx serve frontend\"",
    "test": "nx run-many --target=test --all",
    "lint": "nx run-many --target=lint --all",
    "migrate": "node tools/migrate.js",
    "deploy:railway": "railway up"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mysql2": "^3.6.5",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "compression": "^1.7.4",
    "jsonwebtoken": "^9.0.2",
    "bcryptjs": "^2.4.3",
    "express-validator": "^7.0.1",
    "express-rate-limit": "^7.1.5"
  },
  "devDependencies": {
    "@nx/react": "^17.2.8",
    "@nx/express": "^17.2.8",
    "@nx/vite": "^17.2.8",
    "concurrently": "^8.2.2"
  }
}
```

### Railway Environment Variables Template
```bash
# Railway Environment Variables (Set in Dashboard)

# Backend Service
NODE_ENV=production
PORT=3001
JWT_SECRET=your-super-secure-jwt-secret-min-32-characters
BCRYPT_ROUNDS=12
CORS_ORIGIN=${frontend.PUBLIC_URL}

# Database (Auto-generated by Railway MySQL Plugin)
MYSQLHOST=${MySQL.MYSQLHOST}
MYSQLPORT=${MySQL.MYSQLPORT}
MYSQLUSER=${MySQL.MYSQLUSER}
MYSQLPASSWORD=${MySQL.MYSQLPASSWORD}
MYSQLDATABASE=${MySQL.MYSQLDATABASE}

# Frontend Service
VITE_API_URL=${backend.PUBLIC_URL}
VITE_APP_NAME=My Nx App
VITE_VERSION=1.0.0
```

## üé® Render Deployment Templates

### Render Blueprint (render.yaml)
```yaml
# render.yaml
services:
  - type: web
    name: nx-backend
    env: node
    region: oregon
    plan: starter
    buildCommand: |
      npm ci
      npx nx build backend --prod
    startCommand: node dist/apps/backend/main.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: nx-postgres
          property: connectionString
      - key: CORS_ORIGIN
        fromService:
          type: web
          name: nx-frontend  
          property: host

  - type: web
    name: nx-frontend
    env: static
    region: oregon
    plan: free
    buildCommand: |
      npm ci
      npx nx build frontend --prod
    staticPublishPath: ./dist/apps/frontend
    pullRequestPreviewsEnabled: true
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: nx-backend
          property: host

databases:
  - name: nx-postgres
    databaseName: nx_production
    user: nx_user
    region: oregon
    plan: starter
```

### Render Build Script
```bash
#!/bin/bash
# render-build.sh

set -e

echo "üèó Starting Render build..."

# Install dependencies
npm ci

# Build all apps
echo "Building applications..."
npx nx build backend --prod
npx nx build frontend --prod

# Run database migrations
echo "Running database migrations..."
npm run migrate

echo "‚úÖ Build completed successfully!"
```

## üåä Digital Ocean App Platform Templates

### App Spec Configuration
```yaml
# .do/app.yaml
name: nx-fullstack-production
region: nyc
services:
- name: backend
  source_dir: apps/backend
  github:
    repo: your-username/your-nx-repo
    branch: main
    deploy_on_push: true
  build_command: |
    cd ../.. && npm ci
    cd ../.. && npx nx build backend --prod
  run_command: cd ../.. && node dist/apps/backend/main.js
  environment_slug: node-js
  instance_count: 1
  instance_size_slug: basic-xxs
  http_port: 8080
  health_check:
    http_path: /health
    initial_delay_seconds: 30
    period_seconds: 10
    timeout_seconds: 5
    success_threshold: 1
    failure_threshold: 3
  routes:
  - path: /api
  envs:
  - key: NODE_ENV
    value: "production"
  - key: DATABASE_URL
    value: "${nx-mysql.DATABASE_URL}"
  - key: JWT_SECRET
    value: "your-secret-key"
    type: SECRET
  
- name: frontend
  source_dir: apps/frontend
  github:
    repo: your-username/your-nx-repo
    branch: main
    deploy_on_push: true
  build_command: |
    cd ../.. && npm ci
    cd ../.. && npx nx build frontend --prod
  run_command: cp -r ../../dist/apps/frontend/* .
  environment_slug: node-js
  instance_count: 1
  instance_size_slug: basic-xxs
  routes:
  - path: /
  envs:
  - key: VITE_API_URL
    value: "${backend.PUBLIC_URL}"

databases:
- name: nx-mysql
  engine: MYSQL
  version: "8"
  size: db-s-1vcpu-1gb
  num_nodes: 1
  production: true
```

### Digital Ocean Deploy Script
```bash
#!/bin/bash
# deploy-do.sh

# Install doctl CLI
if ! command -v doctl &> /dev/null; then
  echo "Installing doctl..."
  curl -sL https://github.com/digitalocean/doctl/releases/download/v1.102.0/doctl-1.102.0-linux-amd64.tar.gz | tar -xzv
  sudo mv doctl /usr/local/bin
fi

# Authenticate
doctl auth init --access-token $DO_ACCESS_TOKEN

# Deploy app
doctl apps create --spec .do/app.yaml

echo "‚úÖ Digital Ocean deployment initiated!"
```

## ‚ö° Vercel + External Backend Templates

### Vercel Configuration
```json
{
  "version": 2,
  "framework": "vite",
  "buildCommand": "npx nx build frontend --prod",
  "outputDirectory": "dist/apps/frontend",
  "installCommand": "npm ci",
  "devCommand": "npx nx serve frontend",
  "env": {
    "VITE_API_URL": "https://your-backend.railway.app"
  },
  "build": {
    "env": {
      "VITE_API_URL": "https://your-backend.railway.app"
    }
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        }
      ]
    }
  ],
  "rewrites": [
    {
      "source": "/((?!api/.*).*)",
      "destination": "/index.html"
    }
  ]
}
```

### Vercel Build Script
```bash
#!/bin/bash
# vercel-build.sh

echo "üèó Building for Vercel..."

# Install dependencies
npm ci

# Build frontend only
npx nx build frontend --prod

# Optimize build
echo "Optimizing bundle..."
npx vite-bundle-analyzer dist/apps/frontend/stats.json

echo "‚úÖ Vercel build completed!"
```

## üóÑ Database Setup Templates

### MySQL Schema Template
```sql
-- migrations/001_initial_schema.sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  name VARCHAR(100) NOT NULL,
  role ENUM('user', 'admin') DEFAULT 'user',
  email_verified BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_email (email),
  INDEX idx_created_at (created_at)
);

CREATE TABLE posts (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  title VARCHAR(255) NOT NULL,
  content TEXT,
  slug VARCHAR(255) UNIQUE NOT NULL,
  published BOOLEAN DEFAULT FALSE,
  published_at TIMESTAMP NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_slug (slug),
  INDEX idx_published (published),
  INDEX idx_user_published (user_id, published),
  FULLTEXT(title, content)
);

CREATE TABLE sessions (
  id VARCHAR(128) PRIMARY KEY,
  user_id INT NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_expires (expires_at),
  INDEX idx_user (user_id)
);
```

### Database Connection Template
```typescript
// libs/database/src/lib/connection.ts
import mysql from 'mysql2/promise';

export interface DatabaseConfig {
  host: string;
  port: number;
  user: string;
  password: string;
  database: string;
  ssl?: boolean | mysql.SslOptions;
}

export class Database {
  private pool: mysql.Pool;
  private config: DatabaseConfig;

  constructor(config: DatabaseConfig) {
    this.config = config;
    this.pool = this.createPool();
  }

  private createPool(): mysql.Pool {
    return mysql.createPool({
      host: this.config.host,
      port: this.config.port,
      user: this.config.user,
      password: this.config.password,
      database: this.config.database,
      ssl: this.config.ssl,
      waitForConnections: true,
      connectionLimit: 10,
      queueLimit: 0,
      acquireTimeout: 60000,
      timeout: 60000,
      reconnect: true,
    });
  }

  async query<T = any>(sql: string, params?: any[]): Promise<T[]> {
    const [rows] = await this.pool.execute(sql, params);
    return rows as T[];
  }

  async queryOne<T = any>(sql: string, params?: any[]): Promise<T | null> {
    const results = await this.query<T>(sql, params);
    return results[0] || null;
  }

  async transaction<T>(
    callback: (connection: mysql.PoolConnection) => Promise<T>
  ): Promise<T> {
    const connection = await this.pool.getConnection();
    
    try {
      await connection.beginTransaction();
      const result = await callback(connection);
      await connection.commit();
      return result;
    } catch (error) {
      await connection.rollback();
      throw error;
    } finally {
      connection.release();
    }
  }

  async close(): Promise<void> {
    await this.pool.end();
  }
}

// Factory function
export function createDatabase(): Database {
  const config: DatabaseConfig = {
    host: process.env.MYSQLHOST || 'localhost',
    port: parseInt(process.env.MYSQLPORT || '3306'),
    user: process.env.MYSQLUSER || 'root',
    password: process.env.MYSQLPASSWORD || '',
    database: process.env.MYSQLDATABASE || 'nx_app',
    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,
  };

  return new Database(config);
}
```

## üê≥ Docker Templates (Optional)

### Multi-stage Dockerfile
```dockerfile
# Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY nx.json ./
COPY tsconfig*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy source code
COPY . .

# Build applications
RUN npx nx build frontend --prod
RUN npx nx build backend --prod

# Production stage
FROM node:18-alpine AS runner

WORKDIR /app

# Create non-root user
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copy built applications
COPY --from=builder --chown=nextjs:nodejs /app/dist ./dist
COPY --from=builder --chown=nextjs:nodejs /app/node_modules ./node_modules

# Copy package.json for scripts
COPY --chown=nextjs:nodejs package.json ./

USER nextjs

EXPOSE 3001

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3001/health || exit 1

CMD ["node", "dist/apps/backend/main.js"]
```

### Docker Compose for Development
```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: nx_development
      MYSQL_USER: nx_user
      MYSQL_PASSWORD: nx_password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./tools/migrations/sql:/docker-entrypoint-initdb.d
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      timeout: 10s
      retries: 10

  backend:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - MYSQLHOST=mysql
      - MYSQLPORT=3306
      - MYSQLUSER=nx_user
      - MYSQLPASSWORD=nx_password
      - MYSQLDATABASE=nx_development
      - JWT_SECRET=dev-secret-key
    depends_on:
      mysql:
        condition: service_healthy
    volumes:
      - .:/app
      - /app/node_modules
    command: ["npm", "run", "dev:backend"]

  frontend:
    build: .
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://localhost:3001
    volumes:
      - .:/app
      - /app/node_modules
    command: ["npm", "run", "dev:frontend"]

volumes:
  mysql_data:
```

## üöÄ GitHub Actions Templates

### Complete CI/CD Pipeline
```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  NODE_VERSION: '18'
  NX_CLOUD_ACCESS_TOKEN: ${{ secrets.NX_CLOUD_ACCESS_TOKEN }}

jobs:
  test:
    name: Test & Quality Checks
    runs-on: ubuntu-latest
    
    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: rootpassword
          MYSQL_DATABASE: nx_test
        ports:
          - 3306:3306
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Lint code
        run: npx nx affected --target=lint --parallel=3

      - name: Type check
        run: npx nx affected --target=type-check --parallel=3

      - name: Run unit tests
        run: npx nx affected --target=test --parallel=3 --coverage
        env:
          DATABASE_URL: mysql://root:rootpassword@localhost:3306/nx_test

      - name: Run e2e tests
        run: npx nx affected --target=e2e --parallel=1
        env:
          DATABASE_URL: mysql://root:rootpassword@localhost:3306/nx_test

      - name: Build applications
        run: npx nx affected --target=build --parallel=3 --prod

      - name: Upload coverage reports
        uses: codecov/codecov-action@v3
        with:
          directory: ./coverage

  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/develop'
    environment: staging
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Railway (Staging)
        uses: railway-app/railway-deploy@v1
        with:
          service: staging
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_STAGING_TOKEN }}

  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    environment: production
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Railway (Production)
        uses: railway-app/railway-deploy@v1
        with:
          service: production
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_PRODUCTION_TOKEN }}

      - name: Run database migrations
        run: |
          # Install Railway CLI
          npm install -g @railway/cli
          
          # Run migrations on production
          railway run --service production npm run migrate
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_PRODUCTION_TOKEN }}

      - name: Health check
        run: |
          sleep 30  # Wait for deployment
          curl -f https://your-app.railway.app/health || exit 1
```

### Deployment Status Notifications
```yaml
# .github/workflows/notify.yml
name: Deployment Notifications

on:
  workflow_run:
    workflows: ["CI/CD Pipeline"]
    types: [completed]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'cancelled' }}
    
    steps:
      - name: Notify Slack
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ github.event.workflow_run.conclusion }}
          channel: '#deployments'
          message: |
            ${{ github.event.workflow_run.conclusion == 'success' && '‚úÖ' || '‚ùå' }} 
            Deployment ${{ github.event.workflow_run.conclusion }}
            Branch: ${{ github.event.workflow_run.head_branch }}
            Commit: ${{ github.event.workflow_run.head_sha }}
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

## üì± Frontend Configuration Templates

### Vite Configuration
```typescript
// apps/frontend/vite.config.ts
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '');
  
  return {
    plugins: [react()],
    
    base: './',
    
    build: {
      outDir: '../../dist/apps/frontend',
      sourcemap: mode !== 'production',
      minify: 'esbuild',
      target: 'es2020',
      
      rollupOptions: {
        output: {
          manualChunks: {
            'react-vendor': ['react', 'react-dom', 'react-router-dom'],
            'ui-vendor': ['@mui/material', '@emotion/react', '@emotion/styled'],
            'utils-vendor': ['axios', 'date-fns', 'lodash-es'],
          },
        },
      },
      
      chunkSizeWarningLimit: 1000,
    },

    server: {
      port: 3000,
      host: '0.0.0.0',
      proxy: {
        '/api': {
          target: env.VITE_API_URL || 'http://localhost:3001',
          changeOrigin: true,
          secure: false,
        },
      },
    },

    preview: {
      port: 3000,
      host: '0.0.0.0',
    },

    resolve: {
      alias: {
        '@': resolve(__dirname, 'src'),
        '@shared': resolve(__dirname, '../../libs/shared-types/src'),
        '@ui': resolve(__dirname, '../../libs/ui-components/src'),
      },
    },

    define: {
      __BUILD_TIME__: JSON.stringify(new Date().toISOString()),
      __VERSION__: JSON.stringify(process.env.npm_package_version),
    },

    optimizeDeps: {
      include: ['react', 'react-dom', 'react-router-dom'],
    },
  };
});
```

### API Client Template
```typescript
// libs/api-client/src/lib/client.ts
import axios, { AxiosInstance, AxiosRequestConfig } from 'axios';

export interface ApiClientConfig {
  baseURL: string;
  timeout?: number;
  withCredentials?: boolean;
}

export class ApiClient {
  private client: AxiosInstance;

  constructor(config: ApiClientConfig) {
    this.client = axios.create({
      baseURL: config.baseURL,
      timeout: config.timeout || 10000,
      withCredentials: config.withCredentials ?? true,
    });

    this.setupInterceptors();
  }

  private setupInterceptors() {
    // Request interceptor
    this.client.interceptors.request.use(
      (config) => {
        const token = localStorage.getItem('auth_token');
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
      },
      (error) => Promise.reject(error)
    );

    // Response interceptor
    this.client.interceptors.response.use(
      (response) => response,
      (error) => {
        if (error.response?.status === 401) {
          localStorage.removeItem('auth_token');
          window.location.href = '/login';
        }
        return Promise.reject(error);
      }
    );
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.get(url, config);
    return response.data;
  }

  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.post(url, data, config);
    return response.data;
  }

  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.put(url, data, config);
    return response.data;
  }

  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.delete(url, config);
    return response.data;
  }
}

// Factory function
export function createApiClient(): ApiClient {
  return new ApiClient({
    baseURL: import.meta.env.VITE_API_URL || 'http://localhost:3001',
    withCredentials: true,
  });
}
```

---

**üí° Usage Tips**: 
- Copy the relevant template for your chosen platform
- Replace placeholder values with your actual configuration
- Test locally before deploying to production
- Keep environment variables secure and never commit secrets

---

*Template Examples | Ready-to-deploy Nx configurations for all major platforms*